ازمایش اول ودوم مدار اتصال آردوینو و سنسور اولتراسونیک
برای اتصال سنسور و آردوینو، پایه TRIG ( تریگر) سنسور را به پایه 4 آردوینو متصل کنید. هم چنین باید پایه ECHO سنسور به پایه 5 آردوینو، VCC سنسور به 5V آردوینو و پایه زمین (GND) سنسور به GND آردوینو متصل شود.

کد آردوینو برای اتصال سنسور اولتراسونیک به آردوینو

در این قسمت، کد را به طور کامل و خط به خط برایتان توضیح میدهیم. میتوانید کد کامل را در انتهای این مطلب مشاهده کنید.

const int trigPin = 4; const int echoPin = 5;

در این خط ها، 2 ثابت trigPin و echoPin را برای مشخص کردن اینکه کدام پایه های آردوینو به پایه های trigger  و echo متصل شده اند، تعریف میکنیم. (یعنی پایه 4 به trigger و پایه 5 به echo  متصل است.)

long duration; int distance;

دو متغیر یکی duration از نوع long  و دیگری distance از نوع int تعریف میکنیم. ار این متغیرها برای ذخیره کردن به ترتیب طول پالس پژواک یا اکو و فاصله محاسبه شده استفاده میکنیم.

void setup() { Serial.begin(9600);

در تابع ()setup با آردوینو، ارتباط سریال را با نرخ باد 9600 بیت در ثانیه آغاز میکنیم. و از طریق آن با سریال مانیتور روی صفحه کامپیوتر ارتباط برقرار کرده و فاصله های اندازه گیری شده را میبینیم.

pinMode(trigPin, OUTPUT); pinMode(echoPin, INPUT);

در اینجا، trigPin را به عنوان خروجی و echoPin را به عنوان ورودی پیکربندی میکنیم. این پیکربندی برای کنترل سنسور اولتراسونیک ضروری است. پایه تریگر(TRIG) سیگنال را ارسال میکند (پس خروجی است) درحالیکه پایه اکو (ECHO) سیگنال های بازگشتی را دریافت میکند. ( پس ورودی است)

void loop() { delayMicroseconds(2); digitalWrite(trigPin, HIGH); delayMicroseconds(10); digitalWrite(trigPin, LOW);

درون تابع ()loop، این خط ها اندازه گیری را از سنسور آغاز میکنند. ابتدا پایه تریگر (TRIG)، روی حالت LOW تنظیم میشود و برای مدت کوتاهی در این حالت باقی میماند تا تابع ()delayMicroseconds سیگنال تریگر تمیز را تضمین کند. سپس 10 میکرو ثانیه به حالت HIGH رفته و دوباره به حالت LOW برمیگردد. با وجود این ترتیب درعملکرد، سنسوراولتراسونیک را برای ارسال یک پالس التراسونیک تحریک میکنیم.

duration = pulseIn(echoPin, HIGH);

در این خط از تابع ()pulsen برای اندازه گیری طول پالس دریافتی از پایه اکو (ECHO) بر حسب میکروثانیه استقاده میکنیم.به این صورت که، از زمانی که پایه ECHO به حالت HIGH میرود، تا زمانی که  دوباره به  LOW برسد صبر میکند و فاصله زمانی این دو اتفاق را اندازه گیری میکند.

distance = duration * 0.034 / 2;

کد دراین قسمت، فاصله را براساس طول پالس اکو محاسبه میکند. فرمول استفاده شده در اینجا، براساس سرعت صوت درهوا ( تقریبا 0.034 سانتی متر بر میکروثانیه) است. هم چنین باید درنظر داشته باشیم که پالس به سمت جسم رفته و برمیگردد. پس باید کل مسیر طی شده که همان مسیر رفت و برگشت با هم هست را بر 2 تقسیم کنیم تا فاصله یک مسیر به دست آید.

Serial.print("Distance: "); Serial.print(distance); Serial.println(" cm");

این خط ها، فاصله محاسبه شده را بعد از عبارت “Distance is: “  که یک عبارت توصیفی برای اعداد تولید شده است، در سریال مانیتور نشان خواهند داد. هم چنین بعد از هر عدد محاسبه شده، cm هم برای نشان دادن واحد اندازه گیری نوشته میشود.

delay(1000);

در نهایت یک تاخیر 1000 میلی ثانیه ای ( 1 ثانیه)، سرعت اندازه گیری فاصله را کنترل میکند. میتوان مقدار این تاخیر را برای تغییر فرکانس اندازه گیری مطابق با نیازمان تنظیم کنیم.
مدار اتصال التراسونیک به آردوینو و LCD
مطابق آنچه گفته شد، سنسور و آردوینو را به هم متصل کنید. ( پایه TRIG به پایه 4 و پایه ECHO به پایه 5 آردوینو)
و برای اتصال نمایشگر LCD I2C به آردوینو پایه SDA را به پایه A4 آردوینو، SCL را به پایه A5 آردوینو، VCC را به 5V و GND را به GND متصل کنید.
 برای این منظور میتوانید از کتابخانه LiquidCrystal I2C استفاده کنید. 
کد کامل اتصال آردوینو، سنسور التراسونیک و LCD در پایین موجود است
نحوه کار اتصال آردوینو و سنسور اولتراسونیک را میبینید که متناسب با تغییر فاصله جسم تا سنسور، عدد روی نمایشگر به صورت همزمان تغییر میکند.
